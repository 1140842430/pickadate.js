/*!
 * pickadate.js v3.0.0alpha,Â 2013-04-23
 * By Amsul (http://amsul.ca)
 * Hosted on http://amsul.github.io/pickadate.js
 * Licensed under MIT
 */
(function(e,t,n){"use strict";function i(e){for(var t,n="",i=a(e.min,e);a(e.max,e,[i])>=i;i+=e.i)t=a(e.item,e,[i]),n+=r(e.node,t[0],t[1],t[2]);return n}function r(e,t,n,i){return t?(t=Array.isArray(t)?t.join(""):t,n=n?' class="'+n+'"':"",i=i?" "+i:"","<"+e+n+i+">"+t+"</"+e+">"):""}function o(e){return(10>e?"0":"")+e}function a(e,t,n){return"function"==typeof e?e.apply(t,n||[]):e}function s(e){return/\d/.test(e[1])?2:1}function l(e){return{}.toString.call(e).indexOf("Object")>-1}function u(e){return{}.toString.call(e).indexOf("Date")>-1}function c(e){return{}.toString.call(e).indexOf("Number")>-1&&0===e%1}function d(t,n,i){e.fn[n]=function(i,r){var o=e.extend(!0,{},e.fn[n].defaults,i),s=this.data(n);return s&&"string"==typeof i?"picker"==i?s:a(s[i],s,[r]):this.each(function(){var i=e(this);i.data(n)||i.data(n,new p(i,o,t))})},e.fn[n].defaults=i}function m(e,t){var n=this,i=e.$node.data("value");n.settings=t,n.queue={interval:"i",min:"measure create",max:"measure create",now:"now create",select:"parse create validate",highlight:"create validate",view:"create validate",disable:"flipItem",enable:"flipItem",flip:"flipAll"},n.item={},n.item.interval=t.interval||30,n.item.disable=(t.disable||[]).slice(0),n.item.enable=-function(e){return e[0]===!0?e.shift():-1}(n.item.disable),n.set("min",t.min||[0,0]).set("max",t.max||[v-1,g-1]).set("now").set("select",i||e.$node[0].value||n.item.min,{format:i?t.formatSubmit:t.format}).set("highlight",n.item.select),n.key={40:1,38:-1,39:1,37:-1,go:function(e){n.set("highlight",n.item.highlight.PICK+e*n.item.interval,{interval:e*n.item.interval}),this.render()}},n.onRender=function(){var e=this.$holder,i=e.find("."+t.klass.viewset);i.length?e[0].scrollTop=i.position().top-~~(e[0].clientHeight/4):console.warn("Nothing to viewset with",n.item.view)},n.onOpen=function(){this.$holder.find("button").attr("disable",!1)},n.onClose=function(){this.$holder.find("button").attr("disable",!0)}}var f="pickadate__",h=e(t),p=function(i,o,s){function u(){return r("div",r("div",r("div",v.component.nodes(d.OPEN),m.box),m.wrap),m.frame)}var d={ID:Math.abs(~~(1e9*Math.random()))},m=o.klass,f=i[0],p=function(){return this.start()},v=p.prototype={constructor:p,$node:i,start:function(){return f.autofocus=f==t.activeElement||f.autofocus,d.TYPE=f.type,f.type="text",f.readOnly=!0,v.component=new s(v,o),v.$holder=e(r("div",u(),m.holder)).on({focusin:function(e){v.$holder.removeClass(m.focused),e.stopPropagation()},mousedown:function(e){e.target!=v.$holder[0]&&e.stopPropagation()},click:function(n){var i=e(n.target),r=i.data(),o=t.activeElement;n.preventDefault(),n.target!=v.$holder[0]&&(n.stopPropagation(),o==f||v.$holder.find(o).length||f.focus(),c(r.pick)&&!i.hasClass(m.disabled)?v.set({select:r.pick,highlight:r.pick}).close():r.nav&&!i.hasClass(m.navDisabled)?v.set("highlight",v.component.item.highlight,{nav:r.nav}):r.clear&&v.clear().close())}}),v._hidden=o.formatSubmit?e("<input type=hidden name="+f.name+(o.hiddenSuffix||"_submit")+(f.value||i.data("value")?' value="'+a(v.component.formats.toString,v.component,[o.formatSubmit,v.component.item.select]):"")+'">')[0]:n,i.on("focus.P"+d.ID+" click.P"+d.ID,function(){v.open(),v.$holder.addClass(m.focused)}).on("change.P"+d.ID,function(){v._hidden&&(v._hidden.value=f.value?a(v.component.formats.toString,v.component,[o.formatSubmit,v.component.item.select]):"")}).on("keydown.P"+d.ID,function(e){var t=e.keyCode,n=8==t||46==t;(n||!d.OPEN&&v.component.key[t])&&(e.preventDefault(),e.stopPropagation(),n?v.clear().close():v.open())}).after([v.$holder,v._hidden]),a(v.component.onStart,v),a(o.onStart,v),a(v.component.onRender,v),a(o.onRender,v),f.autofocus&&v.open(),v},render:function(){return v.$holder.html(u()),a(v.component.onRender,v),a(o.onRender,v),v},stop:function(){var e=v.component.onStop;return v.close(),i.off(".P"+d.ID),f.type=d.TYPE,f.readOnly=!1,v._hidden&&v._hidden.parentNode.removeChild(v._hidden),v.$holder.remove(),v.component=n,a(e,v),a(o.onStop,v),v},open:function(){return d.OPEN?v:(d.OPEN=1,i.focus().addClass(m.inputActive),v.$holder.addClass(m.opened),h.on("click.P"+d.ID+" focusin.P"+d.ID,function(e){e.target!=f&&e.target!=t&&v.close()}).on("keydown.P"+d.ID,function(e){var t=e.keyCode,n=v.component.key[t];27==t?(f.focus(),v.close()):e.target!=f||!n&&13!=t||(e.preventDefault(),n?a(v.component.key.go,v,[n]):v.set("select",v.component.item.highlight).close())}),a(v.component.onOpen,v),a(o.onOpen,v),v)},close:function(){return d.OPEN?(d.OPEN=0,i.removeClass(m.inputActive),v.$holder.removeClass(m.opened),h.off(".P"+d.ID),a(v.component.onClose,v),a(o.onClose,v),v):v},clear:function(){return v.set("clear")},set:function(e,t,n){var r=l(e),s=r?e:{};r||(s[e]=t);for(e in s)v.component.item[e]&&v.component.set(e,s[e],n||{}),("select"==e||"clear"==e)&&i.val("clear"==e?"":a(v.component.formats.toString,v.component,[o.format,v.component.get(e)])).trigger("change");return v.render(),a(v.component.onSet,v),a(o.onSet,v,[s]),v},get:function(e){if(e=e||"value","string"==typeof e)return"value"==e?f.value:v.component.item[e];if(l(e))for(var t in e)if(v.component.item[t])return a(v.component.formats.toString,v.component,[e[t],v.component.get(t)])},isOpen:function(){return!!d.OPEN},disableAll:function(e){return v.component.set("flip",e),v.render()}};return new p},v=24,g=60,y=12,b=v*g;m.prototype.set=function(e,t,n){var i=this;return i.item["enable"==e?"disable":"flip"==e?"enable":e]=i.queue[e].split(" ").map(function(r){return t=i[r](e,t,n)}).pop(),"highlight"==e?i.set("view",i.item.highlight,n):"interval"==e?i.set("min",i.item.min,n).set("max",i.item.max,n):("flip"==e||"min"==e||"max"==e||"disable"==e||"enable"==e)&&i.item.select&&i.item.highlight&&("min"==e&&i.set("max",i.item.max,n),i.set("select",i.item.select,n).set("highlight",i.item.highlight,n)),i},m.prototype.get=function(e){return this.item[e]},m.prototype.create=function(e,t,i){var r=this;return t=t===n?e:t,l(t)&&c(t.PICK)?t=t.PICK:Array.isArray(t)?t=+t[0]*g+ +t[1]:c(t)||(t=r.now(e,t,i)),"max"==e&&r.item.min.PICK>t&&(t+=b),t=r.normalize(t,i),{HOUR:~~(v+t/g)%v,MINS:(g+t%g)%g,TIME:(b+t)%b,PICK:t}},m.prototype.now=function(e,t){var n=new Date;return(c(t)?t+1:1)*this.item.interval+n.getHours()*g+n.getMinutes()},m.prototype.normalize=function(e){return e-((0>e?this.item.interval:0)+e%this.item.interval)},m.prototype.measure=function(e,t,n){var i=this;return c(t)?t=i.now(e,t,n):t===!0?t=i.now(e,t,n):l(t)&&c(t.PICK)&&(t=i.normalize(t.PICK,n)),t},m.prototype.validate=function(e,t,n){var i=this,r=n&&n.interval?n.interval:i.item.interval;return i.disabled(t)&&(t=i.shift(t,r)),t=i.scope(t),i.disabled(t)&&(t=i.shift(t,-1*r)),t},m.prototype.disabled=function(e){var t=this,i=t.item.disable.filter(function(i){return c(i)?e.HOUR==i:Array.isArray(i)?e.PICK==t.create(i).PICK:n}).length;return-1===t.item.enable?!i:i},m.prototype.shift=function(e,t){for(var n=this;n.disabled(e)&&(e=n.create(e.PICK+=t||n.item.interval),!(e.PICK<=n.item.min.PICK||e.PICK>=n.item.max.PICK)););return e},m.prototype.scope=function(e){var t=this.item.min.PICK,n=this.item.max.PICK;return this.create(e.PICK>n?n:t>e.PICK?t:e)},m.prototype.parse=function(e,t,n){var i=this,r={};if(!t||c(t)||Array.isArray(t)||u(t)||l(t)&&c(t.PICK))return t;if(!n||!n.format)throw"Need a formatting option to parse this..";return i.formats.toArray(n.format).map(function(e){var n=i.formats[e],o=n?a(n,i,[t,r]):e.replace(/^!/,"").length;n&&(r[e]=t.substr(0,o)),t=t.substr(o)}),+r.i+g*(+(r.H||r.HH)||+(r.h||r.hh)+(/^p/i.test(r.A||r.a)?12:0))},m.prototype.formats={h:function(e,t){return e?s(e):t.HOUR%y||y},hh:function(e,t){return e?2:o(t.HOUR%y||y)},H:function(e,t){return e?s(e):""+t.HOUR},HH:function(e,t){return e?s(e):o(t.HOUR)},i:function(e,t){return e?2:o(t.MINS)},a:function(e,t){return e?4:b/2>t.TIME%b?"a.m.":"p.m."},A:function(e,t){return e?2:b/2>t.TIME%b?"AM":"PM"},toArray:function(e){return e.split(/(h{1,2}|H{1,2}|i|a|A|!.)/g)},toString:function(e,t){var n=this;return n.formats.toArray(e).map(function(e){return a(n.formats[e],n,[0,t])||e.replace(/^!/,"")}).join("")}},m.prototype.flipItem=function(e,t){var n=this,i=n.item.disable,r=-1===n.item.enable;return!r&&"enable"==e||r&&"disable"==e?i=n.removeDisabled(i,t):(!r&&"disable"==e||r&&"enable"==e)&&(i=n.addDisabled(i,t)),i},m.prototype.flipAll=function(e,t){return t===!1?1:-1},m.prototype.addDisabled=function(e,t){var n=this;return t.map(function(t){n.filterDisabled(e,t).length||e.push(t)}),e},m.prototype.removeDisabled=function(e,t){var n=this;return t.map(function(t){e=n.filterDisabled(e,t,1)}),e},m.prototype.filterDisabled=function(e,t,n){var i=Array.isArray(t);return e.filter(function(e){var r=!i&&t===e||i&&Array.isArray(e)&&""+t==""+e;return n?!r:r})},m.prototype.i=function(e,t){return c(t)&&t>0?t:this.item.interval},m.prototype.nodes=function(e){var t=this,n=t.settings,o=t.item.select,s=t.item.highlight,l=t.item.view,u=t.item.disable;return r("ul",i({min:t.item.min.PICK,max:t.item.max.PICK,i:t.item.interval,node:"li",item:function(e){return e=t.create(e),[a(t.formats.toString,t,[n.format,e]),function(i,r){return o&&o.PICK==r&&i.push(n.klass.selected),s&&s.PICK==r&&i.push(n.klass.highlighted),l&&l.PICK==r&&i.push(n.klass.viewset),u&&t.disabled(e)&&i.push(n.klass.disabled),i.join(" ")}([n.klass.listItem],e.PICK),"data-pick="+e.PICK]}})+r("li",r("button",n.clear,n.klass.buttonClear,"data-clear=1"+(e?"":" disabled"))),n.klass.list)},d(m,"pickatime",{clear:"Clear",format:"h:i A",interval:30,klass:{inputActive:f+"input--active",holder:f+"holder "+f+"holder--time",opened:f+"holder--opened",focused:f+"holder--focused",frame:f+"frame",wrap:f+"wrap",box:f+"box",list:f+"list",listItem:f+"list-item",disabled:f+"list-item--disabled",selected:f+"list-item--selected",highlighted:f+"list-item--highlighted",viewset:f+"list-item--viewset",now:f+"list-item--now",buttonClear:f+"button--clear"}})})(jQuery,document);