!function(a,b){"function"==typeof define&&define.amd?define(["jquery","shadow","picker"],b):"object"==typeof exports?module.exports=b(require("jquery"),require("shadow"),require("picker")):a.Pickadate=b(a.$,a.shadow,a.Picker)}(this,function(a,b,c){"use strict";function d(a){return(a>9?"":"0")+a}var e=b._,f=e.el,g=a(document),h=b.Date.create.bind(b.Date),i={name:"Pickadate"};return i.add=function(a,b,c){this._super(a,b,function(a,b){return b.compare(a)},c)},i.attrs={min:null,max:null,today:null,view:null,highlight:null,select:null,format:"d mmmm, yyyy",firstDay:null,show:null},i.classNames={host:" --pickadate",header:"box box--header",body:"box box--body",footer:"box box--footer",container:"container",buttonScope:"button button--scope",buttonPrev:"button button--prev",buttonNext:"button button--next",buttonToday:"button button--today",buttonClear:"button button--clear",buttonDisabled:"button--disabled",grid:"grid",gridTitle:"grid-title",gridCell:"grid-cell",disabled:"grid-cell--disabled",selected:"grid-cell--selected",highlighted:"grid-cell--highlighted",now:"grid-cell--now",infocus:"grid-cell--infocus",outfocus:"grid-cell--outfocus"},i.cloneLastSelection=function(a){var b=this,c=b.attrs;if(a=a||c.select,c.allowMultiple)console.log("todo"),console.log(c.select);else if(c.allowRange)return h(a[a.length-1]);return h(a)},i.cloneSelection=function(a){var b=this,c=b.attrs;return a=a||c.select,c.allowMultiple?void console.log("todo"):c.allowRange?a.map(h):h(a)},i.create=function(b){var c=this._super(b),d=c.attrs;return c.$host.on("mousedown."+c.id,"[data-select]",function(b){function e(a){i=a,d.select=c.getNewSelection(a,f)}b.preventDefault();var f=h(a(b.target).data("select")),i=f;d.select=c.getNewSelection(f);var j;c.$host.on("mouseenter."+c.id,"[data-select]",function(b){var c=h(a(b.target).data("select"));i.month!==c.month?void 0===j&&(j=setTimeout(function(){j=clearTimeout(j)},1e3),e(c)):i.compare(c)||e(c)}),g.on("mouseup."+c.id,function(){c.$host.off("mouseenter."+c.id,"[data-select]"),g.off("mouseup."+c.id)})}),c.$host.on("click","[data-highlight]",function(b){var c=b.target,e=a(c).data("highlight");d.highlight=h(e),d.show="years"==d.show?"months":null}),c},i.dict={today:"Today",clear:"Clear",monthsFull:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdaysFull:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},i.formats={d:function(a,b){return b?(a=a.match(/^\d{1,2}/),a&&a[0]):a.date},dd:function(a,b){return b?(a=a.match(/^\d{1,2}/),a&&a[0]):d(a.date)},ddd:function(a,b){if(b)return a=a.match(/^\w+/),a&&a[0];var c=h([a.year,a.month,a.date]);return this.dict.weekdaysShort[c.day]},dddd:function(a,b){if(b)return a=a.match(/^\w+/),a&&a[0];var c=h([a.year,a.month,a.date]);return this.dict.weekdaysFull[c.day]},m:function(a,b){return b?(a=a.match(/^\d{1,2}/),a&&a[0]):a.month+1},mm:function(a,b){return b?(a=a.match(/^\d{1,2}/),a&&a[0]):d(a.month+1)},mmm:function(a,b){return b?(a=a.match(/^\w+/),a&&a[0]):this.dict.monthsShort[a.month]},mmmm:function(a,b){return b?(a=a.match(/^\w+/),a&&a[0]):this.dict.monthsFull[a.month]},yyyy:function(a,b){return b?(a=a.match(/^\d{4}/),a&&a[0]):a.year}},i.getNewAssignment=function(a){var b=this,c=b.attrs;return c.allowMultiple?b.getNewMultipleAssignment(a):c.allowRange?b.getNewRangeAssignment(a):h(a)},i.getNewMultipleAssignment=function(a){var b=this,c=b.attrs;if(!Array.isArray(a))throw new Error("To get multiple assignments, an array must be used.");return c.allowRange?a.map(function(a){return b.getNewRangeAssignment(a)}):a.map(h).sort(function(a,b){return a.compare("greater",b)?1:-1})},i.getNewMultipleSelection=function(a,b){var c=this,d=c.attrs;if(!d.allowMultiple)throw new Error("Multiple selections are not allowed.");if(d.select){var f=d.select.slice(0);if(d.allowRange){var g=f[f.length-1];if(b&&1===g.length&&b.compare(g[0]))return f[f.length-1]=[b,a],f;var h=c.getNewRangeSelection(a,b);if(b)return f[f.length-1]=h,f;for(var i=0;i<f.length;i++){var j=f[i];if(a.compareRange(j))return f}return console.log("todo:","check for overlapping ranges before pushing a new one"),f.push(h),f}var k=function(a,b){return b.compare(a)};return e.isWithin(f,a,k)?f:(f.push(a),f)}return d.allowRange?[[a]]:[a]},i.getNewRangeAssignment=function(a){if(a.length>2)throw new Error("A range can have a maximum of 2 dates; a lower and upper bound.");return a=a.map(h),1===a.length||a[0].compare(a[1])?[a[0]]:a.sort(function(a,b){return a.compare("greater",b)?1:-1})},i.getNewRangeSelection=function(a,b){var c=this,d=c.attrs;if(!d.allowRange)throw new Error("Range selections are not allowed.");return d.allowMultiple?d.select&&b?[b||d.select[d.select.length-1][0],a]:[a]:!d.select||!b&&2===d.select.length?[a]:[b||d.select[0],a]},i.getNewSelection=function(a,b){var c=this,d=c.attrs;return d.allowMultiple?c.getNewMultipleSelection(a,b):d.allowRange?c.getNewRangeSelection(a,b):a},i.isSelected=function(a,b){var c=this,d=c.attrs;if(!d.select)return!1;if(arguments.length<2&&(b=a,a=""),d.allowMultiple){if(d.allowRange){for(var f=0;f<d.select.length;f++){var g=d.select[f];if(h(b).compareRange(a,g))return!0}return!1}return e.isWithin(d.select,b,function(b,c){return c.compare(a,b)})}return d.allowRange?h(b).compareRange(a,d.select):d.select.compare(a,b)},i.nextEnabledDate=function(a){var c=this,d=c.attrs;e.isTypeOf(a,"date")?a=[a.getFullYear(),a.getMonth(),a.getDate()]:b.Date.isClassOf(a)&&(a=a.value),d.min.compare("greater",a)?a=d.min.value:d.max.compare("lesser",a)&&(a=d.max.value);var f=100,g=a[0],i=a[1],j=a[2],k=h([g,i,j]);for(i=(i+12)%12;f&&k.month!==i;){if(!f)throw"fell into infinite loop..";f-=1,j-=1,k=h([g,i,j])}return k},i.parse=function(a){var b=this,c=b._super(a);if(!c)return null;var d=b.attrs,e=b.dict,f=function(a){var b;if("mmmm"in a){if(b=e.monthsFull.indexOf(a.mmmm),0>b)throw new Error("No month named “"+a.mmmm+"” found.")}else if("mmm"in a&&(b=e.monthsShort.indexOf(a.mmm),0>b))throw new Error("No month named “"+a.mmm+"” found.");return[~~a.yyyy,void 0!==b?b:~~("mm"in a?a.mm:a.m)-1,~~("dd"in a?a.dd:a.d)]};return d.allowMultiple?void console.log("todo"):d.allowRange?c.map(f):f(c)},i.remove=function(a,b,c){this._super(a,b,function(a,b){return b.compare(a)},c)},i.setup=function(){var a=this,b=a.attrs;return a._super(),b.today=h(!0),b.min=h(b.min),b.max=h(b.max),b.select?(b.select=a.cloneSelection(),b.highlight=a.cloneLastSelection()):b.highlight=h(b.highlight?b.highlight:b.today),b.view=b.view?h(b.view,{setToTheFirst:!0}):h(b.highlight,{setToTheFirst:!0}),a.on("assign:select."+a.id,function(b){var c=b.value;c&&(b.value=a.getNewAssignment(c))}),a.on("assign:highlight."+a.id,function(b){var c=a.nextEnabledDate(b.value);b.value=h(c)}),a.on("assign:view."+a.id,function(a){var b=a.value;b=h(b),a.value=h([b.year,b.month,1])}),a.on("assign:min."+a.id+" assign:max."+a.id,function(a){a.value=h(a.value)}),a.on("set:highlight."+a.id,function(a){b.view=a.value}),a.on("set:select."+a.id,function(a){var c=a.value;if(c){if(b.allowMultiple&&b.allowRange){var d=c[c.length-1];c=d[d.length-1]}else(b.allowMultiple||b.allowRange)&&(c=c[c.length-1]);b.highlight=c}}),a.on("set:min."+a.id,function(){b.highlight=b.highlight}),a.on("set:max."+a.id,function(){b.highlight=b.highlight}),a.on("add:select."+a.id+" remove:select."+a.id,function(a){(b.allowMultiple||b.allowRange)&&(b.select=a.value.length?a.value:null)}),a},i.createHeader=function(){var a=this;return f({name:"header",klass:a.classNames.header},[a.createButtonScope(),a.createButtonNav(),a.createButtonNav("next")])},i.createBody=function(){var a=this,b=f({klass:a.classNames.body,attrs:{tabIndex:0}},[a.createGrid(null,[a.createGridHeadDates(),a.createGridBodyDates()]),a.createGrid("months",[a.createGridHeadMonths(),a.createGridBodyMonths()]),a.createGrid("years",[a.createGridHeadYears(),a.createGridBodyYears()])]);return b},i.createFooter=function(){var a=this,b=a.classNames;return f({name:"footer",klass:b.footer},[a.createButtonToday(),a.createButtonClear()])},i.createButtonNav=function(b){var c=this,d=c.attrs,e=c.classNames,g="next"==b,h=f({name:"button",klass:e[g?"buttonNext":"buttonPrev"],attrs:{type:"button"}}),i=function(){var a,b="years"==d.show?"decade":"months"==d.show?"year":"month";a=g?d.max.compare(b+" lesser equal",d.view):d.min.compare(b+" greater equal",d.view),a?(h.classList.add(e.buttonDisabled),h.disabled=!0):h.disabled&&(h.classList.remove(e.buttonDisabled),h.disabled=!1)};return i(),a(h).on("click",function(){var a=d.highlight.year,b=d.highlight.month,c=d.highlight.date,e=g?1:-1;"years"==d.show?a+=10*e:"months"==d.show?a+=e:b+=e,d.highlight=[a,b,c]}),c.on("set:view."+c.id,function(){i()}),c.on("set:show."+c.id,function(){i()}),h},i.createButtonScope=function(){var b=this,c=b.attrs,d=b.classNames,e=b.dict.monthsFull,g=function(){var a=c.view,b=a.year,d=a.month;return"years"==c.show?a.decade:"months"==c.show?b:e[d]+" "+b},h=f({name:"button",klass:d.buttonScope,attrs:{type:"button"}},g());return a(h).on("click",function(){c.show="years"==c.show?null:"months"==c.show?"years":"months"}),b.on("set:show."+b.id,function(){h.textContent=g()}),b.on("set:view."+b.id,function(a){var b=a.value,c=b.year,d=b.month,e=a.previousValue,f=e.year,i=e.month;(c!==f||d!==i)&&(h.textContent=g())}),h},i.createButtonToday=function(){var b=this,c=b.attrs,d=f({name:"button",klass:b.classNames.buttonToday,attrs:{type:"button"}},b.dict.today);return a(d).on("click",function(){c.highlight=c.today,c.show&&(c.show=null)}),d},i.createButtonClear=function(){var b=this,c=b.attrs,d=f({name:"button",klass:b.classNames.buttonClear,attrs:{type:"button"}},b.dict.clear);return a(d).on("click",function(){c.select=null,c.show&&(c.show=null)}),d},i.createGrid=function(b,c){b||(b=null);var d=this,e=d.attrs,g=d.classNames,h=function(a){i.hidden=a!==b},i=f(g.container,f({name:"table",klass:g.grid},c));return h(e.show),d.on("set:show."+d.id,function(a){h(a.value)}),d.on("set:select."+d.id,function(b){b.value||a(i).find("."+g.selected).removeClass(g.selected)}),i},i.createGridHeadYears=function(){var a=this,b=a.attrs.view,c=f({name:"th",attrs:{scope:"col",colspan:4}},b.decade),d=b.year;return a.on("set:view."+a.id,function(a){var b=a.value.year;b!==d&&(d=b,c.textContent=a.value.decade)}),f({name:"thead"},c)},i.createGridHeadMonths=function(){var a=this,b=a.attrs.view.year,c=f({name:"th",attrs:{scope:"col",colspan:4}},b);return a.on("set:view."+a.id,function(a){var d=a.value.year;d!==b&&(b=d,c.textContent=b)}),f({name:"thead"},c)},i.createGridHeadDates=function(){var a=this,b=a.classNames,c=a.attrs,d=a.dict,e=function(){var a=document.createDocumentFragment(),e=d.weekdaysShort.slice(0),g=d.weekdaysFull.slice(0),h=c.firstDay;h&&(e.push(e.shift()),g.push(g.shift()));for(var i=0;7>i;i++){var j=f({name:"th",klass:b.gridTitle,attrs:{scope:"col",title:g[i]}},e[i]);a.appendChild(j)}return a},g=f({name:"thead"},e());return a.on("set:firstDay."+a.id,function(){g.innerHTML="",g.appendChild(e())}),g},i.createGridBodyYears=function(){var a=this,b=a.attrs,c=a.classNames,d=function(d){var e=h([d,b.highlight.month,b.highlight.date]),g=e.time,i=b.min.compare("year greater",g)||b.max.compare("year lesser",g),j=f({name:"td",klass:c.gridCell+" "+(b.view.compare("decade",e)?c.infocus:c.outfocus)+(a.isSelected("year",g)?" "+c.selected:"")+(b.highlight.compare("year",g)?" "+c.highlighted:"")+(b.today.compare("year",g)?" "+c.now:"")+(i?" "+c.disabled:"")},d);return i||j.setAttribute("data-highlight",g),j},e=function(){for(var a=document.createDocumentFragment(),c=b.view.decade.start,e=0;3>e;e++){for(var g=f({name:"tr"}),h=0;4>h;h++){var i=h+4*e-1,j=d(c+i);g.appendChild(j)}a.appendChild(g)}return a},g=f({name:"tbody"},e());return a.on("set:view."+a.id,function(){g.innerHTML="",g.appendChild(e())}),g},i.createGridBodyMonths=function(){var a=this,b=a.classNames,c=a.attrs,d=a.dict,e=function(e){var g=[c.view.year,e,c.highlight.date],i=h(g);i.month!==e&&(i=a.nextEnabledDate(g));var j=i.time,k=c.min.compare("month greater",j)||c.max.compare("month lesser",j),l=d.monthsShort,m=f({name:"td",klass:b.gridCell+(a.isSelected("month",j)?" "+b.selected:"")+(c.highlight.compare("month",j)?" "+b.highlighted:"")+(c.today.compare("month",j)?" "+b.now:"")+(k?" "+b.disabled:"")},l[i.month]);return k||m.setAttribute("data-highlight",j),m},g=function(){for(var a=document.createDocumentFragment(),b=0;3>b;b++){for(var c=f({name:"tr"}),d=0;4>d;d++){var g=d+4*b,h=e(g);c.appendChild(h)}a.appendChild(c)}return a},i=f({name:"tbody"},g());return a.on("set:view."+a.id,function(){i.innerHTML="",i.appendChild(g())}),i},i.createGridBodyDates=function(){var a=this,b=a.attrs,c=a.classNames,d=function(d,e,g){var i=h([d,e,g]),j=i.time,k=b.min.compare("greater",j)||b.max.compare("lesser",j),l=f({name:"td",klass:c.gridCell+" "+(b.view.month===i.month?c.infocus:c.outfocus)+(a.isSelected(j)?" "+c.selected:"")+(b.highlight.compare(j)?" "+c.highlighted:"")+(b.today.compare(j)?" "+c.now:"")+(k?" "+c.disabled:"")},i.date);return k||l.setAttribute("data-select",j),l},e=function(a,c,e){for(var g=b.firstDay,i=h([a,c,1]).day,j=document.createDocumentFragment(),k=1;7>=k;k++){var l=7*e+k-i;g&&(l+=1),j.appendChild(d(a,c,l))}return f({name:"tr"},j)},g=function(){var a=b.view.year,c=b.view.month,d=b.firstDay,f=document.createDocumentFragment(),g=0;d&&0===h([a,c,1]).day&&(g=-1);for(var i=0;5>=i;i++)f.appendChild(e(a,c,i+g));return f},i=f({name:"tbody"},g()),j="set:view."+a.id+" set:firstDay."+a.id;return a.on(j,function(){i.innerHTML="",i.appendChild(g())}),i},i.template=function(){var a=this,b=a.content;return b.appendChild(a.createHeader()),b.appendChild(a.createBody()),b.appendChild(a.createFooter()),a._super()},i=c.extend(i)});