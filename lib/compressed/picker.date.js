/*!
 * pickadate.js v3.0.0-alpha,Â 2013-05-03
 * By Amsul (http://amsul.ca)
 * Hosted on http://amsul.github.io/pickadate.js
 * Licensed under MIT
 */
function DatePicker(e,t){var r=this,i=e.$node.data("value");r.settings=t,r.queue={min:"measure create",max:"measure create",now:"now create",select:"parse create validate",highlight:"navigate create validate",view:"create viewset",disable:"flipItem",enable:"flipItem"},r.item={},r.item.disable=(t.disable||[]).slice(0),r.item.enable=-function(e){return e[0]===!0?e.shift():-1}(r.item.disable),r.set("min",t.min).set("max",t.max).set("now").set("select",i||e.$node[0].value||r.item.now,{format:i?t.formatSubmit:t.format,data:!!i}).set("highlight",r.item.select),r.key={40:7,38:-7,39:1,37:-1,go:function(e){r.set("highlight",[r.item.highlight.year,r.item.highlight.month,r.item.highlight.date+e],{interval:e}),this.render()}},e.on("render",function(){e.$holder.find("."+t.klass.selectMonth).on("change",function(){e.set("highlight",[e.get("view").year,this.value,e.get("highlight").date]),e.$holder.find("."+t.klass.selectMonth).focus()}),e.$holder.find("."+t.klass.selectYear).on("change",function(){e.set("highlight",[this.value,e.get("view").month,e.get("highlight").date]),e.$holder.find("."+t.klass.selectYear).focus()})}).on("open",function(){e.$holder.find("button, select").attr("disabled",!1)}).on("close",function(){e.$holder.find("button, select").attr("disabled",!0)})}var DAYS_IN_WEEK=7,WEEKS_IN_CALENDAR=6;DatePicker.prototype.set=function(e,t,r){var i=this;return i.item["enable"==e?"disable":"flip"==e?"enable":e]=i.queue[e].split(" ").map(function(a){return t=i[a](e,t,r)}).pop(),"highlight"==e?i.set("view",i.item.highlight,r):("flip"==e||"min"==e||"max"==e||"disable"==e||"enable"==e)&&i.item.select&&i.item.highlight&&i.set("select",i.item.select,r).set("highlight",i.item.highlight,r),i},DatePicker.prototype.get=function(e){return this.item[e]},DatePicker.prototype.create=function(e,t,r){var i,a=this;return t=void 0===t?e:t,t==-1/0||1/0==t?i=t:t=isObject(t)&&isInteger(t.pick)?t.obj:Array.isArray(t)?new Date(t[0],t[1],t[2]):isInteger(t)||isDate(t)?a.normalize(new Date(t),r):a.now(e,t,r),{year:i||t.getFullYear(),month:i||t.getMonth(),date:i||t.getDate(),day:i||t.getDay(),obj:i||t,pick:i||t.getTime()}},DatePicker.prototype.now=function(e,t,r){return t=new Date,r&&r.rel&&t.setDate(t.getDate()+r.rel),this.normalize(t,r)},DatePicker.prototype.navigate=function(e,t,r){return isObject(t)&&(t=[t.year,t.month+(r&&r.nav?r.nav:0),t.date]),t},DatePicker.prototype.normalize=function(e){return e.setHours(0,0,0,0),e},DatePicker.prototype.measure=function(e,t){var r=this;return t?isInteger(t)&&(t=r.now(e,t,{rel:t})):t="min"==e?-1/0:1/0,t},DatePicker.prototype.viewset=function(e,t){return this.create([t.year,t.month,1])},DatePicker.prototype.validate=function(e,t,r){var i=this,a=r&&r.interval?r.interval:1;return i.disabled(t)&&(t=i.shift(t,a)),t=i.scope(t),i.disabled(t)&&(t=i.shift(t,t.pick<=i.item.min.pick?1:t.pick>=i.item.max.pick?-1:a)),t},DatePicker.prototype.disabled=function(e){var t=this,r=t.item.disable.filter(function(r){return isInteger(r)?e.day===(t.settings.firstDay?r:r-1)%7:Array.isArray(r)?e.pick===t.create(r).pick:void 0}).length;return-1===t.item.enable?!r:r},DatePicker.prototype.shift=function(e,t){var r=this,i=e;for(t=t||1;r.disabled(e)&&(e=r.create([e.year,e.month,e.date+t]),Math.abs(e.month-i.month)>2&&(e=i,t=-1===r.item.enable?0>t?1:-1:0>t?-1:1),!(e.pick<=r.item.min.pick||e.pick>=r.item.max.pick)););return e},DatePicker.prototype.scope=function(e){var t=this.item.min.pick,r=this.item.max.pick;return this.create(e.pick>r?r:t>e.pick?t:e)},DatePicker.prototype.parse=function(e,t,r){var i=this,a={};if(!t||isInteger(t)||Array.isArray(t)||isDate(t)||isObject(t)&&isInteger(t.pick))return t;if(!r||!r.format)throw"Need a formatting option to parse this..";return i.formats.toArray(r.format).map(function(e){var r=i.formats[e],n=r?triggerFunction(r,i,[t,a]):e.replace(/^!/,"").length;r&&(a[e]=t.substr(0,n)),t=t.substr(n)}),[a.yyyy||a.yy,+(a.mm||a.m)-(r.data?1:0),a.dd||a.d]},DatePicker.prototype.formats=function(){var e=function(e,t,r){var i=e.match(/\w+/)[0];return r.mm||r.m||(r.m=t.indexOf(i)),i.length};return{d:function(e,t){return e?getDigitsLength(e):t.date},dd:function(e,t){return e?2:leadZero(t.date)},ddd:function(e,t){return e?getFirstWordLength(e):this.settings.weekdaysShort[t.day]},dddd:function(e,t){return e?getFirstWordLength(e):this.settings.weekdaysFull[t.day]},m:function(e,t){return e?getDigitsLength(e):t.month+1},mm:function(e,t){return e?2:leadZero(t.month+1)},mmm:function(t,r){var i=this.settings.monthsShort;return t?e(t,i,r):i[r.month]},mmmm:function(t,r){var i=this.settings.monthsFull;return t?e(t,i,r):i[r.month]},yy:function(e,t){return e?2:(""+t.year).slice(2)},yyyy:function(e,t){return e?4:t.year},toArray:function(e){return e.split(/(d{1,4}|m{1,4}|y{4}|yy|!.)/g)},toString:function(e,t){var r=this;return r.formats.toArray(e).map(function(e){return triggerFunction(r.formats[e],r,[0,t])||e.replace(/^!/,"")}).join("")}}}(),DatePicker.prototype.flipItem=function(e,t){var r=this,i=r.item.disable,a=-1===r.item.enable;return"flip"==t?r.item.enable=a?1:-1:!a&&"enable"==e||a&&"disable"==e?i=r.removeDisabled(i,t):(!a&&"disable"==e||a&&"enable"==e)&&(i=r.addDisabled(i,t)),i},DatePicker.prototype.addDisabled=function(e,t){var r=this;return t.map(function(t){r.filterDisabled(e,t).length||e.push(t)}),e},DatePicker.prototype.removeDisabled=function(e,t){var r=this;return t.map(function(t){e=r.filterDisabled(e,t,1)}),e},DatePicker.prototype.filterDisabled=function(e,t,r){var i=Array.isArray(t);return e.filter(function(e){var a=!i&&t===e||i&&Array.isArray(e)&&""+t==""+e;return r?!a:a})},DatePicker.prototype.nodes=function(e){var t=this,r=t.settings,i=t.item.now,a=t.item.select,n=t.item.highlight,o=t.item.view,s=t.item.disable,l=t.item.min,c=t.item.max,u=function(e){return r.firstDay&&e.push(e.shift()),createNode("thead",createGroupOfNodes({min:0,max:DAYS_IN_WEEK-1,i:1,node:"th",item:function(t){return[e[t],r.klass.weekdays]}}))}((r.showWeekdaysFull?r.weekdaysFull:r.weekdaysShort).slice(0)),d=function(e){return createNode("div"," ",r.klass["nav"+(e?"Next":"Prev")]+(e&&o.year>=c.year&&o.month>=c.month||!e&&o.year<=l.year&&o.month<=l.month?" "+r.klass.navDisabled:""),"data-nav="+(e||-1))},h=function(e){return r.selectMonths?createNode("select",createGroupOfNodes({min:0,max:11,i:1,node:"option",item:function(t){return[e[t],0,"value="+t+(o.month==t?" selected":"")+(o.year==l.year&&l.month>t||o.year==c.year&&t>c.month?" disabled":"")]}}),r.klass.selectMonth):createNode("div",e[o.month],r.klass.month)},m=function(){var e=o.year,t=r.selectYears===!0?5:~~(r.selectYears/2);if(t){var i=l.year,a=c.year,n=e-t,s=e+t;if(i>n&&(s+=i-n,n=i),s>a){var u=n-i,d=s-a;n-=u>d?d:u,s=a}return createNode("select",createGroupOfNodes({min:n,max:s,i:1,node:"option",item:function(t){return[t,0,"value="+t+(e==t?" selected":"")]}}),r.klass.selectYear)}return createNode("div",e,r.klass.year)};return createNode("div",d()+d(1)+h(r.showMonthsShort?r.monthsShort:r.monthsFull)+m(),r.klass.header)+createNode("table",u+createNode("tbody",createGroupOfNodes({min:0,max:WEEKS_IN_CALENDAR-1,i:1,node:"tr",item:function(e){return[createGroupOfNodes({min:DAYS_IN_WEEK*e-o.day+1,max:function(){return this.min+DAYS_IN_WEEK-1},i:1,node:"td",item:function(e){return e=t.create([o.year,o.month,e+(r.firstDay?1:0)]),[createNode("div",e.date,function(u){return u.push(o.month==e.month?r.klass.infocus:r.klass.outfocus),i.pick==e.pick&&u.push(r.klass.now),a&&a.pick==e.pick&&u.push(r.klass.selected),n&&n.pick==e.pick&&u.push(r.klass.highlighted),(s&&t.disabled(e)||e.pick<l.pick||e.pick>c.pick)&&u.push(r.klass.disabled),u.join(" ")}([r.klass.day]),"data-pick="+e.pick)]}})]}})),r.klass.table)+createNode("div",createNode("button",r.today,r.klass.buttonToday,"data-pick="+i.pick+(e?"":" disabled"))+createNode("button",r.clear,r.klass.buttonClear,"data-clear=1"+(e?"":" disabled")),r.klass.footer)},Picker.extend("pickadate",DatePicker,{monthsFull:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdaysFull:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],today:"Today",clear:"Clear",format:"d mmmm, yyyy",klass:{input:CLASSES_PREFIX+"input",active:CLASSES_PREFIX+"input--active",holder:CLASSES_PREFIX+"holder",opened:CLASSES_PREFIX+"holder--opened",focused:CLASSES_PREFIX+"holder--focused",frame:CLASSES_PREFIX+"frame",wrap:CLASSES_PREFIX+"wrap",box:CLASSES_PREFIX+"box",table:CLASSES_PREFIX+"table",header:CLASSES_PREFIX+"header",navPrev:CLASSES_PREFIX+"nav--prev",navNext:CLASSES_PREFIX+"nav--next",navDisabled:CLASSES_PREFIX+"nav--disabled",month:CLASSES_PREFIX+"month",year:CLASSES_PREFIX+"year",selectMonth:CLASSES_PREFIX+"select--month",selectYear:CLASSES_PREFIX+"select--year",weekdays:CLASSES_PREFIX+"weekday",day:CLASSES_PREFIX+"day",disabled:CLASSES_PREFIX+"day--disabled",selected:CLASSES_PREFIX+"day--selected",highlighted:CLASSES_PREFIX+"day--highlighted",now:CLASSES_PREFIX+"day--today",infocus:CLASSES_PREFIX+"day--infocus",outfocus:CLASSES_PREFIX+"day--outfocus",footer:CLASSES_PREFIX+"footer",buttonClear:CLASSES_PREFIX+"button--clear",buttonToday:CLASSES_PREFIX+"button--today"}});