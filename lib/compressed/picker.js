/*!
 * pickadate.js v3.0.0-alpha,Â 2013-05-07
 * By Amsul, http://amsul.ca
 * Hosted on http://amsul.github.io/pickadate.js
 * Licensed under MIT
 */
window.Picker=function(e,t){function n(r,i,o,a){function s(){return n._.node("div",n._.node("div",n._.node("div",n._.node("div",m.component.nodes(l.open),u.box),u.wrap),u.frame),u.holder)}function c(){m.open(),m.$holder.addClass(u.focused)}if(!r)return n;var l={id:Math.abs(~~(1e9*Math.random()))},d=o?$.extend(!0,{},o.defaults,a):a||{},u=$.extend({},n.klasses(),d.klass),h=$(r),p=function(){return this.start()},m=p.prototype={constructor:p,$node:h,start:function(){return l&&l.start?m:(l.methods={},l.start=!0,l.open=!1,l.type=r.type,r.autofocus=r==document.activeElement,r.type="text",r.readOnly=!0,m.component=new o(m,d),m.$holder=$(n._.node("div",s(),u.picker)).on({focusin:function(e){m.$holder.removeClass(u.focused),e.stopPropagation()},mousedown:function(e){e.target!=m.$holder.children()[0]&&e.stopPropagation()},click:function(e){var t=e.target,i=$(t),o=i.data();t!=m.$holder.children()[0]&&(e.stopPropagation(),!m.$holder.find(document.activeElement).length&&l.open&&r.focus(),o.nav&&!i.hasClass(u.navDisabled)?m.set("highlight",m.component.item.highlight,{nav:o.nav}):n._.isInteger(o.pick)&&!i.hasClass(u.disabled)?m.set({select:o.pick,highlight:o.pick}).close(!0):o.clear&&m.clear().close(!0))}}),m._hidden=d.formatSubmit?$("<input type=hidden name="+r.name+(d.hiddenSuffix||"_submit")+(h.data("value")?' value="'+n._.trigger(m.component.formats.toString,m.component,[d.formatSubmit,m.component.item.select]):"")+'">')[0]:t,h.addClass(u.input).on("focus.P"+l.id,c).on("click.P"+l.id,m.open).on("change.P"+l.id,function(){m._hidden&&(m._hidden.value=r.value?n._.trigger(m.component.formats.toString,m.component,[d.formatSubmit,m.component.item.select]):"")}).on("keydown.P"+l.id,function(e){var t=e.keyCode,n=/^(8|46)$/.test(t);(32==t||n||!l.open&&m.component.key[t])&&(e.preventDefault(),e.stopPropagation(),n?m.clear().close():m.open())}).val(h.data("value")?n._.trigger(m.component.formats.toString,m.component,[d.format,m.component.item.select]):"").after(m.$holder,m._hidden).data(i,m),m.on({start:m.component.onStart,render:m.component.onRender,stop:m.component.onStop,open:m.component.onOpen,close:m.component.onClose,set:m.component.onSet}).on({start:d.onStart,render:d.onRender,stop:d.onStop,open:d.onOpen,close:d.onClose,set:d.onSet}),r.autofocus&&m.open(),m.trigger("start").trigger("render"))},render:function(){return m.$holder.html(s()),m.trigger("render")},stop:function(){return l.start?(m.close(),m._hidden&&m._hidden.parentNode.removeChild(m._hidden),m.$holder.remove(),h.removeClass(u.input).off(".P"+l.id).removeData(i),r.type=l.type,r.readOnly=!1,m.trigger("stop"),l.methods={},l.start=!1,m):m},open:function(){return l.open?m:(l.open=!0,h.focus().addClass(u.active),m.$holder.addClass(u.opened),e.on("click.P"+l.id+" focusin.P"+l.id,function(e){e.target!=r&&e.target!=document&&m.close()}).on("keydown.P"+l.id,function(e){var t=e.keyCode,i=m.component.key[t],o=e.target;27==t?m.close(!0):o!=r||!i&&13!=t?m.$holder.find(o).length&&13==t&&(e.preventDefault(),o.click()):(e.preventDefault(),i?n._.trigger(m.component.key.go,m,[i]):m.set("select",m.component.item.highlight).close())}),m.trigger("open"))},close:function(t){return t&&(h.off("focus.P"+l.id).focus(),setTimeout(function(){h.on("focus.P"+l.id,c)},0)),l.open?(l.open=!1,h.removeClass(u.active),m.$holder.removeClass(u.opened+" "+u.focused),e.off(".P"+l.id),m.trigger("close")):m},clear:function(){return m.set("clear")},set:function(e,t,r){var i,o,a=n._.isObject(e),s=a?e:{};if(e){a||(s[e]=t);for(i in s)o=s[i],m.component.item[i]&&m.component.set(i,o,r||{}),("select"==i||"clear"==i)&&h.val("clear"==i?"":n._.trigger(m.component.formats.toString,m.component,[d.format,m.component.get(i)])).trigger("change");m.render()}return m.trigger("set",s)},get:function(e,i){return e=e||"value",null!=l[e]?l[e]:"value"==e?r.value:m.component.item[e]?"string"==typeof i?n._.trigger(m.component.formats.toString,m.component,[i,m.component.get(e)]):m.component.get(e):t},on:function(e,t){var r,i,o=n._.isObject(e),a=o?e:{};if(e){o||(a[e]=t);for(r in a)i=a[r],l.methods[r]=l.methods[r]||[],l.methods[r].push(i)}return m},trigger:function(e,t){var r=l.methods[e];return r&&r.map(function(e){n._.trigger(e,m,[t])}),m}};return new p}return n.klasses=function(e){return e=e||"picker",{picker:e,opened:e+"--opened",focused:e+"--focused",input:e+"__input",active:e+"__input--active",holder:e+"__holder",frame:e+"__frame",wrap:e+"__wrap",box:e+"__box"}},n._={group:function(e){for(var t,r="",i=n._.trigger(e.min,e);n._.trigger(e.max,e,[i])>=i;i+=e.i)t=n._.trigger(e.item,e,[i]),r+=n._.node(e.node,t[0],t[1],t[2]);return r},node:function(e,t,n,r){return t?(t=Array.isArray(t)?t.join(""):t,n=n?' class="'+n+'"':"",r=r?" "+r:"","<"+e+n+r+">"+t+"</"+e+">"):""},lead:function(e){return(10>e?"0":"")+e},trigger:function(e,t,n){return"function"==typeof e?e.apply(t,n||[]):e},digits:function(e){return/\d/.test(e[1])?2:1},isObject:function(e){return{}.toString.call(e).indexOf("Object")>-1},isDate:function(e){return{}.toString.call(e).indexOf("Date")>-1},isInteger:function(e){return{}.toString.call(e).indexOf("Number")>-1&&0===e%1}},n.extend=function(e,t){$.fn[e]=function(r,i){var o=this.data(e);return"picker"==r?o:o&&"string"==typeof r?(n._.trigger(o[r],o,[i]),this):this.each(function(){var i=$(this);i.data(e)||new n(this,e,t,r)})},$.fn[e].defaults=t.defaults},n}($(document));