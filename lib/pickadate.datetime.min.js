/*!
 * pickadate.js v3.0.0alpha,Â 2013-04-21
 * By Amsul (http://amsul.ca)
 * Hosted on http://amsul.github.io/pickadate.js
 * Licensed under MIT
 */
(function(t,e,n){"use strict";function i(t,e){var n=this,i=t.$node.data("value");n.settings=e,n.queue={min:"measure create",max:"measure create",now:"now create",select:"parse create validate",highlight:"navigate create validate",view:"create viewset",disable:"flipItem",enable:"flipItem",flip:"flipAll"},n.item={},n.item.disable=(e.disable||[]).slice(0),n.item.enable=-function(t){return t[0]===!0?t.shift():-1}(n.item.disable),n.set("min",e.min||-1/0).set("max",e.max||1/0).set("now").set("select",i||t.$node[0].value||n.item.now,{format:i?e.formatSubmit:e.format,data:!!i}).set("highlight",n.item.select),n.key={40:7,38:-7,39:1,37:-1,go:function(t){n.set("highlight",[n.item.highlight.YEAR,n.item.highlight.MONTH,n.item.highlight.DATE+t],{interval:t}),this.render()}},n.onRender=function(t){var i=this;t.find("."+e.klass.selectMonth).on("change",function(){i.set("highlight",[n.get("view").YEAR,this.value,n.get("highlight").DATE]),t.find("."+e.klass.selectMonth).focus()}),t.find("."+e.klass.selectYear).on("change",function(){i.set("highlight",[this.value,n.get("view").MONTH,n.get("highlight").DATE]),t.find("."+e.klass.selectYear).focus()})},n.onOpen=function(t){t.find("button, select").attr("disabled",!1)},n.onClose=function(t){t.find("button, select").attr("disabled",!0)}}function r(t,e){var n=this,i=t.$node.data("value");n.settings=e,n.queue={interval:"i",min:"measure create",max:"measure create",now:"now create",select:"parse create validate",highlight:"create validate",view:"create validate",disable:"flipItem",enable:"flipItem",flip:"flipAll"},n.item={},n.item.interval=e.interval||30,n.item.disable=(e.disable||[]).slice(0),n.item.enable=-function(t){return t[0]===!0?t.shift():-1}(n.item.disable),n.set("min",e.min||[0,0]).set("max",e.max||[p-1,v-1]).set("now").set("select",i||t.$node[0].value||n.item.min,{format:i?e.formatSubmit:e.format}).set("highlight",n.item.select),n.key={40:1,38:-1,39:1,37:-1,go:function(t){n.set("highlight",n.item.highlight.PICK+t*n.item.interval,{interval:t*n.item.interval}),this.render()}},n.onRender=function(t){var i=t.find("."+e.klass.viewset);i.length?t[0].scrollTop=i.position().top-~~(t[0].clientHeight/4):console.warn("Nothing to viewset with",n.item.view)},n.onOpen=function(t){t.find("button").attr("disable",!1)},n.onClose=function(t){t.find("button").attr("disable",!0)}}function o(t){for(var e,n="",i=l(t.min,t);l(t.max,t,[i])>=i;i+=t.i)e=l(t.item,t,[i]),n+=a(t.node,e[0],e[1],e[2]);return n}function a(t,e,n,i){return e?(e=Array.isArray(e)?e.join(""):e,n=n?' class="'+n+'"':"",i=i?" "+i:"","<"+t+n+i+">"+e+"</"+t+">"):""}function s(t){return(10>t?"0":"")+t}function l(t,e,n){return"function"==typeof t?t.apply(e,n||[]):t}function u(t){return/\d/.test(t[1])?2:1}function c(t){return{}.toString.call(t).indexOf("Object")>-1}function m(t){return{}.toString.call(t).indexOf("Date")>-1}function d(t){return{}.toString.call(t).indexOf("Number")>-1&&0===t%1}var f=7,h=6;i.prototype.set=function(t,e,n){var i=this;return i.item["enable"==t?"disable":"flip"==t?"enable":t]=i.queue[t].split(" ").map(function(r){return e=i[r](t,e,n)}).pop(),"highlight"==t?i.set("view",i.item.highlight,n):("flip"==t||"min"==t||"max"==t||"disable"==t||"enable"==t)&&i.item.select&&i.item.highlight&&i.set("select",i.item.select,n).set("highlight",i.item.highlight,n),i},i.prototype.get=function(t){return this.item[t]},i.prototype.create=function(t,e,i){var r,o=this;return e=e===n?t:e,e==-1/0||1/0==e?r=e:e=c(e)&&d(e.PICK)?e.TIME:Array.isArray(e)?new Date(e[0],e[1],e[2]):d(e)||m(e)?o.normalize(new Date(e),i):o.now(t,e,i),{YEAR:r||e.getFullYear(),MONTH:r||e.getMonth(),DATE:r||e.getDate(),DAY:r||e.getDay(),TIME:r||e,PICK:r||e.getTime()}},i.prototype.now=function(t,e,n){return e=new Date,n&&n.rel&&e.setDate(e.getDate()+n.rel),this.normalize(e,n)},i.prototype.navigate=function(t,e,n){return c(e)&&(e=[e.YEAR,e.MONTH+(n&&n.nav?n.nav:0),e.DATE]),e},i.prototype.normalize=function(t){return t.setHours(0,0,0,0),t},i.prototype.measure=function(t,e,n){var i=this;return d(e)&&(n.rel=e,e=i.now(t,e,n)),e},i.prototype.viewset=function(t,e){return this.create([e.YEAR,e.MONTH,1])},i.prototype.validate=function(t,e,n){var i=this,r=n&&n.interval?n.interval:1;return i.disabled(e)&&(e=i.shift(e,r)),e=i.scope(e),i.disabled(e)&&(e=i.shift(e,e.PICK<=i.item.min.PICK?1:e.PICK>=i.item.max.PICK?-1:r)),e},i.prototype.disabled=function(t){var e=this,i=e.item.disable.filter(function(i){return d(i)?t.DAY==(e.settings.firstDay?i:i-1)%7:Array.isArray(i)?t.PICK==e.create(i).PICK:n}).length;return-1===e.item.enable?!i:i},i.prototype.shift=function(t,e){for(var n=this,i=t;n.disabled(t)&&(t=n.create([t.YEAR,t.MONTH,t.DATE+(e||1)]),t.MONTH==i.MONTH););return t},i.prototype.scope=function(t){var e=this.item.min.PICK,n=this.item.max.PICK;return this.create(t.PICK>n?n:e>t.PICK?e:t)},i.prototype.parse=function(t,e,n){var i=this,r={};if(!e||d(e)||Array.isArray(e)||m(e)||c(e)&&d(e.PICK))return e;if(!n||!n.format)throw"Need a formatting option to parse this..";return i.formats.toArray(n.format).map(function(t){var n=i.formats[t],o=n?l(n,i,[e,r]):t.replace(/^!/,"").length;n&&(r[t]=e.substr(0,o)),e=e.substr(o)}),[r.yyyy||r.yy,+(r.mm||r.m)-(n.data?1:0),r.dd||r.d]},i.prototype.formats=function(){var t=function(t,e,n){var i=t.match(/\w+/)[0];return n.mm||n.m||(n.m=e.indexOf(i)),i.length};return{d:function(t,e){return t?u(t):e.DATE},dd:function(t,e){return t?2:s(e.DATE)},ddd:function(t,e){return t?getFirstWordLength(t):this.settings.weekdaysShort[e.DAY]},dddd:function(t,e){return t?getFirstWordLength(t):this.settings.weekdaysFull[e.DAY]},m:function(t,e){return t?u(t):e.MONTH+1},mm:function(t,e){return t?2:s(e.MONTH+1)},mmm:function(e,n){var i=this.settings.monthsShort;return e?t(e,i,n):i[n.MONTH]},mmmm:function(e,n){var i=this.settings.monthsFull;return e?t(e,i,n):i[n.MONTH]},yy:function(t,e){return t?2:(""+e.YEAR).slice(2)},yyyy:function(t,e){return t?4:e.YEAR},toArray:function(t){return t.split(/(d{1,4}|m{1,4}|y{4}|yy|!.)/g)},toString:function(t,e){var n=this;return n.formats.toArray(t).map(function(t){return l(n.formats[t],n,[0,e])||t.replace(/^!/,"")}).join("")}}}(),i.prototype.flipItem=function(t,e){var n=this,i=n.item.disable,r=-1===n.item.enable;return!r&&"enable"==t||r&&"disable"==t?i=n.removeDisabled(i,e):(!r&&"disable"==t||r&&"enable"==t)&&(i=n.addDisabled(i,e)),i},i.prototype.flipAll=function(t,e){return e===!1?1:-1},i.prototype.addDisabled=function(t,e){var n=this;return e.map(function(e){n.filterDisabled(t,e).length||t.push(e)}),t},i.prototype.removeDisabled=function(t,e){var n=this;return e.map(function(e){t=n.filterDisabled(t,e,1)}),t},i.prototype.filterDisabled=function(t,e,n){var i=Array.isArray(e);return t.filter(function(t){var r=!i&&e===t||i&&Array.isArray(t)&&""+e==""+t;return n?!r:r})},i.prototype.nodes=function(t){var e=this,n=e.settings,i=e.item.now,r=e.item.select,s=e.item.highlight,l=e.item.view,u=e.item.disable,c=e.item.min,m=e.item.max,d=function(t){return n.firstDay&&t.push(t.shift()),a("thead",o({min:0,max:f-1,i:1,node:"th",item:function(e){return[t[e],n.klass.weekdays]}}))}((n.showWeekdaysFull?n.weekdaysFull:n.weekdaysShort).slice(0)),p=function(t){return a("div"," ",n.klass["nav"+(t?"Next":"Prev")]+(t&&l.YEAR>=m.YEAR&&l.MONTH>=m.MONTH||!t&&l.YEAR<=c.YEAR&&l.MONTH<=c.MONTH?" "+n.klass.navDisabled:""),"data-nav="+(t||-1))},v=function(t){return n.selectMonths?a("select",o({min:0,max:11,i:1,node:"option",item:function(e){return[t[e],0,"value="+e+(l.MONTH==e?" selected":"")+(l.YEAR==c.YEAR&&c.MONTH>e||l.YEAR==m.YEAR&&e>m.MONTH?" disabled":"")]}}),n.klass.selectMonth):a("div",t[l.MONTH],n.klass.month)},g=function(){var t=l.YEAR,e=n.selectYears===!0?5:~~(n.selectYears/2);if(e){var i=c.YEAR,r=m.YEAR,s=t-e,u=t+e;if(i>s&&(u+=i-s,s=i),u>r){var d=s-i,f=u-r;s-=d>f?f:d,u=r}return a("select",o({min:s,max:u,i:1,node:"option",item:function(e){return[e,0,"value="+e+(t==e?" selected":"")]}}),n.klass.selectYear)}return a("div",t,n.klass.year)};return a("div",p()+p(1)+v(n.showMonthsShort?n.monthsShort:n.monthsFull)+g(),n.klass.header)+a("table",d+a("tbody",o({min:0,max:h-1,i:1,node:"tr",item:function(t){return[o({min:f*t-l.DAY+1,max:function(){return this.min+f-1},i:1,node:"td",item:function(t){return t=e.create([l.YEAR,l.MONTH,t+(n.firstDay?1:0)]),[a("div",t.DATE,function(o){return o.push(l.MONTH==t.MONTH?n.klass.infocus:n.klass.outfocus),i.PICK==t.PICK&&o.push(n.klass.now),r&&r.PICK==t.PICK&&o.push(n.klass.selected),s&&s.PICK==t.PICK&&o.push(n.klass.highlighted),(u&&e.disabled(t)||t.PICK<c.PICK||t.PICK>m.PICK)&&o.push(n.klass.disabled),o.join(" ")}([n.klass.day]),"data-pick="+t.PICK)]}})]}})),n.klass.table)+a("div",a("button",n.today,n.klass.buttonToday,"data-pick="+i.PICK+(t?"":" disabled"))+a("button",n.clear,n.klass.buttonClear,"data-clear=1"+(t?"":" disabled")),n.klass.footer)};var p=24,v=60,g=12,y=p*v;r.prototype.set=function(t,e,n){var i=this;return i.item["enable"==t?"disable":"flip"==t?"enable":t]=i.queue[t].split(" ").map(function(r){return e=i[r](t,e,n)}).pop(),"highlight"==t?i.set("view",i.item.highlight,n):"interval"==t?i.set("min",i.item.min,n).set("max",i.item.max,n):("flip"==t||"min"==t||"max"==t||"disable"==t||"enable"==t)&&i.item.select&&i.item.highlight&&("min"==t&&i.set("max",i.item.max,n),i.set("select",i.item.select,n).set("highlight",i.item.highlight,n)),i},r.prototype.get=function(t){return this.item[t]},r.prototype.create=function(t,e,i){var r=this;return e=e===n?t:e,c(e)&&d(e.PICK)?e=e.PICK:Array.isArray(e)?e=+e[0]*v+ +e[1]:d(e)||(e=r.now(t,e,i)),"max"==t&&r.item.min.PICK>e&&(e+=y),e=r.normalize(e,i),{HOUR:~~(p+e/v)%p,MINS:(v+e%v)%v,TIME:(y+e)%y,PICK:e}},r.prototype.now=function(t,e){var n=new Date;return(d(e)?e+1:1)*this.item.interval+n.getHours()*v+n.getMinutes()},r.prototype.normalize=function(t){return t-((0>t?this.item.interval:0)+t%this.item.interval)},r.prototype.measure=function(t,e,n){var i=this;return d(e)?e=i.now(t,e,n):e===!0?e=i.now(t,e,n):c(e)&&d(e.PICK)&&(e=i.normalize(e.PICK,n)),e},r.prototype.validate=function(t,e,n){var i=this,r=n&&n.interval?n.interval:i.item.interval;return i.disabled(e)&&(e=i.shift(e,r)),e=i.scope(e),i.disabled(e)&&(e=i.shift(e,-1*r)),e},r.prototype.disabled=function(t){var e=this,i=e.item.disable.filter(function(i){return d(i)?t.HOUR==i:Array.isArray(i)?t.PICK==e.create(i).PICK:n}).length;return-1===e.item.enable?!i:i},r.prototype.shift=function(t,e){for(var n=this;n.disabled(t)&&(t=n.create(t.PICK+=e||n.item.interval),!(t.PICK<=n.item.min.PICK||t.PICK>=n.item.max.PICK)););return t},r.prototype.scope=function(t){var e=this.item.min.PICK,n=this.item.max.PICK;return this.create(t.PICK>n?n:e>t.PICK?e:t)},r.prototype.parse=function(t,e,n){var i=this,r={};if(!e||d(e)||Array.isArray(e)||m(e)||c(e)&&d(e.PICK))return e;if(!n||!n.format)throw"Need a formatting option to parse this..";return i.formats.toArray(n.format).map(function(t){var n=i.formats[t],o=n?l(n,i,[e,r]):t.replace(/^!/,"").length;n&&(r[t]=e.substr(0,o)),e=e.substr(o)}),+r.i+v*(+(r.H||r.HH)||+(r.h||r.hh)+(/^p/i.test(r.A||r.a)?12:0))},r.prototype.formats={h:function(t,e){return t?u(t):e.HOUR%g||g},hh:function(t,e){return t?2:s(e.HOUR%g||g)},H:function(t,e){return t?u(t):""+e.HOUR},HH:function(t,e){return t?u(t):s(e.HOUR)},i:function(t,e){return t?2:s(e.MINS)},a:function(t,e){return t?4:y/2>e.TIME%y?"a.m.":"p.m."},A:function(t,e){return t?2:y/2>e.TIME%y?"AM":"PM"},toArray:function(t){return t.split(/(h{1,2}|H{1,2}|i|a|A|!.)/g)},toString:function(t,e){var n=this;return n.formats.toArray(t).map(function(t){return l(n.formats[t],n,[0,e])||t.replace(/^!/,"")}).join("")}},r.prototype.flipItem=function(t,e){var n=this,i=n.item.disable,r=-1===n.item.enable;return!r&&"enable"==t||r&&"disable"==t?i=n.removeDisabled(i,e):(!r&&"disable"==t||r&&"enable"==t)&&(i=n.addDisabled(i,e)),i},r.prototype.flipAll=function(t,e){return e===!1?1:-1},r.prototype.addDisabled=function(t,e){var n=this;return e.map(function(e){n.filterDisabled(t,e).length||t.push(e)}),t},r.prototype.removeDisabled=function(t,e){var n=this;return e.map(function(e){t=n.filterDisabled(t,e,1)}),t},r.prototype.filterDisabled=function(t,e,n){var i=Array.isArray(e);return t.filter(function(t){var r=!i&&e===t||i&&Array.isArray(t)&&""+e==""+t;return n?!r:r})},r.prototype.i=function(t,e){return d(e)&&e>0?e:this.item.interval},r.prototype.nodes=function(t){var e=this,n=e.settings,i=e.item.select,r=e.item.highlight,s=e.item.view,u=e.item.disable;return a("ul",o({min:e.item.min.PICK,max:e.item.max.PICK,i:e.item.interval,node:"li",item:function(t){return t=e.create(t),[l(e.formats.toString,e,[n.format,t]),function(o,a){return i&&i.PICK==a&&o.push(n.klass.selected),r&&r.PICK==a&&o.push(n.klass.highlighted),s&&s.PICK==a&&o.push(n.klass.viewset),u&&e.disabled(t)&&o.push(n.klass.disabled),o.join(" ")}([n.klass.listItem],t.PICK),"data-pick="+t.PICK]}})+a("li",a("button",n.clear,n.klass.buttonClear,"data-clear=1"+(t?"":" disabled"))),n.klass.list)};var b="pickadate__",A=t(e),I=function(i,r,o){function s(){return a("div",a("div",a("div",p.component.nodes(u.OPEN),m.box),m.wrap),m.frame)}var u={ID:Math.abs(~~(1e9*Math.random()))},m=r.klass,f=i[0],h=function(){return this.start()},p=h.prototype={constructor:h,$node:i,start:function(){return f.autofocus=f==e.activeElement||f.autofocus,u.TYPE=f.type,f.type="text",f.readOnly=!0,p.component=new o(p,r),p.$box=t(a("div",s(),m.holder)).on({focusin:function(t){p.$box.removeClass(m.focused),t.stopPropagation()},mousedown:function(t){t.target!=p.$box[0]&&t.stopPropagation()},click:function(n){console.log("click",n.target.nodeName);var i=t(n.target),r=i.data(),o=e.activeElement;n.preventDefault(),n.target!=p.$box[0]&&(n.stopPropagation(),o==f||p.$box.find(o).length||f.focus(),d(r.pick)&&!i.hasClass(m.disabled)?p.set({select:r.pick,highlight:r.pick}).close():r.nav&&!i.hasClass(m.navDisabled)?p.set("highlight",p.component.item.highlight,{nav:r.nav}):r.clear&&p.clear().close())}}),p._hidden=r.formatSubmit?t("<input type=hidden name="+f.name+(r.hiddenSuffix||"_submit")+(f.value||i.data("value")?' value="'+l(p.component.formats.toString,p.component,[r.formatSubmit,p.component.item.select]):"")+'">')[0]:n,i.on("focus.P"+u.ID+" click.P"+u.ID,function(){p.open(),p.$box.addClass(m.focused)}).on("change.P"+u.ID,function(){p._hidden&&(p._hidden.value=f.value?l(p.component.formats.toString,p.component,[r.formatSubmit,p.component.item.select]):"")}).on("keydown.P"+u.ID,function(t){var e=t.keyCode,n=8==e||46==e;(n||!u.OPEN&&p.component.key[e])&&(t.preventDefault(),t.stopPropagation(),n?p.clear().close():p.open())}).after([p.$box,p._hidden]),l(p.component.onStart,p,[p.$box]),l(r.onStart,p,[p.$box]),l(p.component.onRender,p,[p.$box]),l(r.onRender,p,[p.$box]),f.autofocus&&p.open(),p},render:function(){return p.$box.html(s()),l(p.component.onRender,p,[p.$box]),l(r.onRender,p,[p.$box]),p},stop:function(){var t=p.component.onStop;return p.close(),i.off(".P"+u.ID),f.type=u.TYPE,f.readOnly=!1,p._hidden&&p._hidden.parentNode.removeChild(p._hidden),p.$box.remove(),p.component=n,l(t,p),l(r.onStop,p,[p.$box]),p},open:function(){return u.OPEN?p:(u.OPEN=1,i.focus().addClass(m.inputActive),p.$box.addClass(m.opened),A.on("click.P"+u.ID+" focusin.P"+u.ID,function(t){t.target!=f&&t.target!=e&&p.close()}).on("keydown.P"+u.ID,function(t){var e=t.keyCode,n=p.component.key[e];27==e?(f.focus(),p.close()):t.target!=f||!n&&13!=e||(t.preventDefault(),n?l(p.component.key.go,p,[n]):p.set("select",p.component.item.highlight).close())}),l(p.component.onOpen,p,[p.$box]),l(r.onOpen,p,[p.$box]),p)},close:function(){return u.OPEN?(u.OPEN=0,i.removeClass(m.inputActive),p.$box.removeClass(m.opened),A.off(".P"+u.ID),l(p.component.onClose,p,[p.$box]),l(r.onClose,p,[p.$box]),p):p},clear:function(){return p.set("clear")},set:function(t,e,n){var o=c(t),a=o?t:{};o||(a[t]=e);for(t in a)p.component.item[t]&&p.component.set(t,a[t],n||{}),("select"==t||"clear"==t)&&i.val("clear"==t?"":l(p.component.formats.toString,p.component,[r.format,p.component.get(t)])).trigger("change");return p.render(),l(p.component.onSet,p,[p.$box]),l(r.onSet,p,[p.$box]),p},get:function(t){if("string"==typeof t)return"value"==t?f.value:p.component.item[t];if(c(t))for(var e in t)if(p.component.item[e])return l(p.component.formats.toString,p.component,[t[e],p.component.get(e)])},isOpen:function(){return!!u.OPEN},disableAll:function(t){return p.component.set("flip",t),p.render()}};return new h};["pickadate","pickatime"].map(function(e,n){t.fn[e]=function(o,a){var s=t.extend(!0,{},t.fn[e].defaults,o),u=this.data(e);return u&&"string"==typeof o?"picker"==o?u:l(u[o],u,[a]):this.each(function(){var o=t(this);o.data(e)||o.data(e,new I(o,s,n?r:i))})}}),t.fn.pickadate.defaults={today:"Today",clear:"Clear",monthsFull:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdaysFull:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],format:"d mmmm, yyyy",klass:{inputActive:b+"input--active",holder:b+"holder",opened:b+"holder--opened",focused:b+"holder--focused",frame:b+"frame",wrap:b+"wrap",box:b+"box",table:b+"table",header:b+"header",navPrev:b+"nav--prev",navNext:b+"nav--next",navDisabled:b+"nav--disabled",month:b+"month",year:b+"year",selectMonth:b+"select--month",selectYear:b+"select--year",weekdays:b+"weekday",day:b+"day",disabled:b+"day--disabled",selected:b+"day--selected",highlighted:b+"day--highlighted",now:b+"day--today",infocus:b+"day--infocus",outfocus:b+"day--outfocus",footer:b+"footer",buttonClear:b+"button--clear",buttonToday:b+"button--today"}},t.fn.pickatime.defaults={clear:"Clear",format:"h:i A",interval:30,klass:{inputActive:b+"input--active",holder:b+"holder "+b+"holder--time",opened:b+"holder--opened",focused:b+"holder--focused",frame:b+"frame",wrap:b+"wrap",box:b+"box",list:b+"list",listItem:b+"list-item",disabled:b+"list-item--disabled",selected:b+"list-item--selected",highlighted:b+"list-item--highlighted",viewset:b+"list-item--viewset",now:b+"list-item--now",buttonClear:b+"button--clear"}}})(jQuery,document);